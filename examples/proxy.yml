# Locals are used to store variables that can be reused in the configuration.
locals:
  name: 'proxy-{{ BlueGreen }}'
  port: '{{ AB "8081" "8082" }}'
  tmpdir: '{{ EnvDefault "TMPDIR" "/tmp" }}'

# Example of zero-downtime deployment with proxying traffic between two containers.
workdir: examples/proxy
cmd: ['sh', './start.sh', '{{ Local "port" }}']
env:
- 'CONTAINER_NAME={{ Local "name" }}'

# Enable proxy.
proxy:
- listen: 'unix://{{ Local "tmpdir" }}/proxy.sock'
  forward: 'localhost:{{ Local "port" }}'
pidfile: '{{ Local "tmpdir" }}/proxy.pid'

# See healthcheck_docker.yml for more details.
healthcheck:
  docker:
    container: '{{ Local "name" }}'
